<html>
	<head>
		<title>PDF to TXT</title>
		<style>
			body {
				padding: 0;
				margin: 0;
				font-size: 15px;
				font-family: Helvetica;
				background-color: #eee;
			}
			#left {
				float: left;
				width:20%;
			}
			#right {
				float: right;
				width:80%;
			}
			#logo, #topbar {
				padding-top: 20px;
				width: 100%;
				height: 40px;
			}
			#drop, #list {
				box-sizing: border-box;
				height: 100%;
				margin-top: -60px;
				padding-top: 60px;
			}
			#logo {
				padding: 10px;
				font-size: 20px;
				color: white;
				font-size: 30px;
				font-weight: 700;
			}
			#dropmsg {
				margin-top: 150px;
				text-align: center;
			}
			#topbar {
				padding-right: 10px;
			}
			#list {
				height: 100%;
			}
			#list .item {
				margin: 5px;
				padding: 10px;
				border-radius: 3px;
				background-color: white;
			}
			.button {
				float: right;
				cursor: pointer;
				height: 16px;
				padding: 3px 6px 3px 6px;
				margin-right: 3px;
				border-radius: 20px;
				background-color: white;
				box-shadow: 0 0 5px rgba(0,0,0,0.6);
			}
			.button:hover, #drop:hover {
				color: white;
				background-color: lightslategray;
			}
		</style>
	</head>
<body>
	<div id="left">
		<div id="logo">PDF to TXT</div>
		<div id="drop" ondrop="drop(event);" ondragover="dragOver(event);" ondragenter="dragEnter(event);" ondragleave="dragLeave(event);">
			<div id="dropmsg">DROP FILE HERE</div>
		</div>
	</div><div id="right">
		<div id="topbar">
			<span class="button" onclick="deleteAll();" title="delete all files">DELETE ALL</span>
			<span class="button" onclick="seeAll();" title="see all files sanitized and concatenated">SEE ALL</span>
		</div>
		<div id="list"></div>
		
	</div>
</body>
<script>
	function dragOver(e) {
		e.preventDefault();	
	}
	function dragEnter(e) {
		e.preventDefault();
		var msg = document.getElementById("dropmsg");
		msg.innerHTML = "YES HERE";
	}
	function dragLeave(e) {
		e.preventDefault();	
		var msg = document.getElementById("dropmsg");
		msg.innerHTML = "DROP FILE HERE";
	}
	function drop(e) {
		e.preventDefault();
		var msg = document.getElementById("dropmsg");
		msg.innerHTML = "WAIT ...";
		let files = e.dataTransfer.files;
		([...files]).forEach(uploadFile);
	}

	function uploadFile(file) {
		let url = '/upload'
		let formData = new FormData()
		var msg = document.getElementById("dropmsg");

		formData.append('file', file)

		fetch(url, {
			method: 'POST',
			body: formData
		})
		.then(() => {
			msg.innerHTML = "SUCCESS";
			setTimeout(function(){ msg.innerHTML = "DROP FILE HERE"; }, 2000);
		})
		.then(loadFileList)
		.catch(() => {
			msg.innerHTML = "ERROR";
		})
	}
	function deleteFile(fileName) {
		fetch('/delete/' + fileName)
		.then(loadFileList);
	}
	function deleteAll() {
		fetch('/delete/all')
		.then(loadFileList);
	}

	function seeSanitized(fileName) {
		window.open("/get/sanitized/" + fileName, '_blank').focus();
	}
	function seeOriginal(fileName) {
		window.open("/get/original/" + fileName, '_blank').focus();
	}
	function seeAll() {
		window.open("/get/all", '_blank').focus();
	}

	function loadFileList() {
		fetch('/list')
		.then(response => response.json())
		.then(displayList);
	}
	function displayList(data) {
		var list = document.getElementById("list");
		list.innerHTML = "";
		data.forEach(fileName => {
			list.innerHTML += "<div class='item'>" + decodeURI(fileName).replace(/\+/g, ' ')
							+ "<span class='button' onclick='deleteFile(\"" + fileName + "\")' title='delete file'>X</span>"
							+ "<span class='button' onclick='seeOriginal(\"" + fileName + "\")' title='see original file'>O</span>"
							+ "<span class='button' onclick='seeSanitized(\"" + fileName + "\")' title='see sanitized file'>S</span>"
							+ "</div>";
		});
	}

	loadFileList();
</script>
</html>