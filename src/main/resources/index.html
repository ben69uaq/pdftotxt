<html>
	<head>
		<title>PDFtoTXT</title>
		<style>
			body {
				padding: 0;
				margin: 0;
				font-size: 15px;
				font-family: Helvetica;
				background-color: lightgray;
			}
			#logo {
				position: fixed;
				bottom: 0;
				right: 0;
				z-index: -1;
				padding: 10px;
				color: darkgray;
				font-size: 100px;
				font-weight: 700;
			}
			#logo span {
				font-size: 80px;
				font-weight: 300;
			}
			#bar {
				position: fixed;
				top: 0;
				right: 25px;
				width: 100%;
				height: 35px;
				padding-top: 15px;
				background-color: lightgray;
			}
			#zone {
				position: fixed;
				top: 0;
				left: 0;
				width: 240px;
				height: 100%;
				padding-top: 200px;
				text-align: center;
				font-size: 20px;
				font-weight: bold;
				background-color: darkgrey;
			}
			#list {
				box-sizing: border-box;
				width: 100%;
				height: 100%;
				padding: 50px 10px 10px 250px;
				overflow-y: auto;
			}
			#list .item {
				padding: 10px;
				margin-bottom: 5px;
				border-radius: 5px;
				background-color: white;
				box-shadow: 0 0 5px darkgray;
			}
			.button {
				cursor: pointer;
				float: right;
				height: 16px;
				padding: 3px 6px ;
				margin: -2px 4px 0 0;
				border-radius: 20px;
				background-color: white;
				box-shadow: 0 0 5px lightslategray;
			}
			.button:hover, #zone:hover, #zone.highlighted	 {
				color: white;
				background-color: lightslategray;
			}
		</style>
	</head>
<body>
	<div id="logo">PDF<span>to</span>TXT</div>
	<div id="bar">
		<span class="button" onclick="deleteAll();" title="delete all files">DELETE ALL</span>
		<span class="button" onclick="seeAll();" title="see all files sanitized and concatenated">SEE ALL</span>
	</div>
	<div id="zone" ondrop="drop(event);" ondragover="dragOver(event);" ondragenter="dragEnter(event);" ondragleave="dragLeave(event);">DROP FILE HERE</div>
	<div id="list"></div>
</body>
<script>
	function dragOver(e) {
		e.preventDefault();	
	}
	function dragEnter(e) {
		zone.className = "highlighted";
		zone.innerHTML = "YES HERE";
	}
	function dragLeave(e) {
		zone.className = "";
		zone.innerHTML = "DROP FILE HERE";
	}
	function drop(e) {
		e.preventDefault();
		zone.innerHTML = "WAIT ...";
		let files = e.dataTransfer.files;
		([...files]).forEach(uploadFile);
	}
	function uploadFile(file) {
		let formData = new FormData()
		formData.append('file', file)
		fetch('/upload', {
			method: 'POST',
			body: formData
		})
		.then(() => {
			zone.innerHTML = "SUCCESS";
			setTimeout(function(){
				zone.className = "";
				zone.innerHTML = "DROP FILE HERE";
			}, 2000);
		})
		.then(loadFileList)
		.catch(() => {
			zone.innerHTML = "ERROR";
			setTimeout(function(){
				zone.className = "";
				zone.innerHTML = "DROP FILE HERE";
			}, 2000);
		})
	}
	function deleteFile(fileName) {
		fetch('/delete/' + fileName)
		.then(loadFileList);
	}
	function deleteAll() {
		fetch('/delete/all')
		.then(loadFileList);
	}
	function seeSanitized(fileName) {
		window.open("/get/sanitized/" + fileName, '_blank').focus();
	}
	function seeOriginal(fileName) {
		window.open("/get/original/" + fileName, '_blank').focus();
	}
	function seeAll() {
		window.open("/get/all", '_blank').focus();
	}
	function loadFileList() {
		fetch('/list')
		.then(response => response.json())	
		.then(displayList);
	}
	function displayList(data) {
		list.innerHTML = "";
		data.forEach(fileName => {
			list.innerHTML += "<div class='item'>" + decodeURI(fileName).replace(/\+/g, ' ')
							+ "<span class='button' onclick='deleteFile(\"" + fileName + "\")' title='delete file'>X</span>"
							+ "<span class='button' onclick='seeOriginal(\"" + fileName + "\")' title='see original file'>O</span>"
							+ "<span class='button' onclick='seeSanitized(\"" + fileName + "\")' title='see sanitized file'>S</span>"
							+ "</div>";
		});
	}
	loadFileList();
</script>
</html>